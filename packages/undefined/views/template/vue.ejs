<script>
Vue.use(VueRouter)

const router = new VueRouter({
  routes: [{
    path: '/buttons',
    component: {
      template: '#buttons-template'
    }
  }, 
  {
    path: '/cars',
    component: {
      template: '#cars-template',
      data: () => ({
        search: '',
        headers: [
          {
            text: 'Name',
            align: 'left',
            value: 'displayName'
          },
          { text: 'Manufacturer', value: 'manufacturerName' },
          { text: 'Max Speed', value: 'maxSpeed' },
          { text: 'Class', value: 'vehicleClass' },
          { text: 'Action', value: 'name', sortable: false }
        ],
        cars: vehiclesArray,
        selectedCar: null
      })
    }
  }]
})

Vue.component('speedometer', {
  template: '<canvas></canvas>',
  props: {
    value: Number,
    options: {
      type: Object,
      default: () => ({})
    }
  },
  data () {
    return {}
  },
  mounted () {
    if (this.value) this.options.value = this.value
    this.options.renderTo = this.$el
    window.speedometer = new RadialGauge(this.options).draw()
  }
})

const app = new Vue({
  el: '#app',
  router,
  data: () => ({
    alerts: [],
    speed: 0,
    isDriving: false,
    options: {
      renderTo: 'gauge',
      width: 300,
      height: 300,
      units: "km/h",
      minValue: 0,
      maxValue: 220,
      majorTicks: [
          "0",
          "20",
          "40",
          "60",
          "80",
          "100",
          "120",
          "140",
          "160",
          "180",
          "200",
          "220"
      ],
      minorTicks: 2,
      strokeTicks: true,
      highlights: [
          {
              "from": 160,
              "to": 220,
              "color": "rgba(200, 50, 50, .75)"
          }
      ],
      colorPlate: "rgba(10, 10, 10, 0.3)",
      colorUnits: 'white',
      colorNumbers: 'white',
      colorMajorTicks: 'white',
      colorMinorTicks: 'rgba(255, 255, 255, 0.7)',
      borderShadowWidth: 0,
      borders: false,
      valueBox: false,
      needleType: "arrow",
      needleWidth: 2,
      needleCircleSize: 7,
      needleCircleOuter: true,
      needleCircleInner: false,
      animationDuration: 100
    }
  }),
  methods: {
    alert: function(data = {}) {
      class Alert {
        constructor(data) {
          this.type = data.type || 'info'
          this.time = data.time || 10000
          this.text = data.text || `i am a placeholder text for an ${this.type} alert.`
          this.color = data.color
          this.icon = data.icon
          this.value = true
          this.active = true
          this.id = Math.random().toString(36).substring(2)
        }
      }

      data = new Alert(data)
      this.alerts.push(data)

      let audio = new Audio(`/sounds/${data.type}.ogg`)
      audio.play()

      setTimeout(() => {
        $(`#${data.id}`).slideUp('normal', () => {
          this.alerts[this.alerts.indexOf(data)].active = false
          if (this.alerts.filter(e => e.active).length === 0) {
            this.alerts = []
          }
          console.log(this.alerts.length)
        })
      }, data.time)
    }
  }
})

window.vue = app
</script>